[
  {
    "_id": ObjectId("000000000000000000000121"),
    "name": "Appointment Filter",
    "type": "filter-group",
    "label": "Filters",
    "screen": [
      {
        "type": "div",
        "comment": "spacer",
        "layoutStyle": { "flex-grow": 1, "width": "1px" }
      },
      {
        "type": "input",
        "key": "search",
        "label": "Search ...",
        "floatLabel": "never",
        "icon": "search",
        "iconColor": "white",
        "style": {
          "margin-top": "-12px",
          "margin-bottom": "-8px"
        },
        "class": {
          "white": true
        },
        "changed": "this.event.send({ name: 'refresh', key: 'table' })"
      },
      {
        "type": "button",
        "buttonType": "mat-icon-button",
        "icon": "note_add",
        "click": "this.router.navigateByUrl(`/task/detail`)"
      }
    ]
  },
  {
    "_id": ObjectId("000000000000000000000120"),
    "type": "data-table",
    "tableType": "table",
    "key": "table",
    "name": "Scheduled Task",
    "src": "/adminapi/core.scheduled_task",
    "method": "get",
    "transform": "response.data",
    "click": "this.router.navigateByUrl(`/task/detail?_id=${row._id}`)",
    "columns": [
      {
        "key": "name",
        "label": "Task name",
        "style": {
          "color": "blue",
          "fontWeight": "bold",
          "cursor": "pointer",
          "textDecoration": "underline"
        }
      },
      {
        "key": "next_run_date",
        "label": "Next Run",
        "format": "moment(v).format('L LT')"
      },
      {
        "key": "last_run_result",
        "label": "Last Status",
        "canAutoResize": false
      }
    ]
  },
  {
    "_id": ObjectId("000000000000000000000123"),
    "type": "layout",
    "layoutStyle": {
      "background": "#F44336",
      "width": "100%",
      "display": "flex",
      "flex-wrap": "wrap",
      "color": "white"
    },
    "screen": [
      {
        "type": "div",
        "comment": "spacer",
        "layoutStyle": { "flex-grow": 1, "width": "1px" }
      },
      {
        "type": "typography",
        "condition": "!this.data._id",
        "default": "this.data._params_._id?'Loading ...':'Must Save'",
        "layoutStyle": {
          "text-align": "center"
        },
        "style": {
          "padding": "10px",
          "text-transform": "uppercase",
          "font-weight": "bold",
          "color": "chartreuse"
        }
      },
      {
        "type": "button",
        "buttonType": "mat-icon-button",
        "icon": "save",
        "click": "this.event.send({ 'name': 'save' });"
      }
    ]
  },
  {
    "_id": ObjectId("000000000000000000000122"),
    "type": "form-generator",
    "src": "this.data._params_._id?`/adminapi/core.scheduled_task?_id=${this.data._params_._id}`:''",
    "method": "get",
    "transform": "response.data[0]",
    "layoutStyle": {
      "flex-grow": 1,
      "display": "flex",
      "flex-direction": "column",
      "height": "100%",
      "overflow-y": "auto"
    },
    "save": {
      "src": "`/adminapi/core.scheduled_task`",
      "method": "post",
      "saveAction": "if(!this.data._id) { this.data._id = response._id; this.nav.setParam('_id', response._id, true); } this.snackBar.open('Salvato', null, { duration: 2000 });"
    },
    "screen": [
      {
        "expanded": true,
        "style": {
          "width": "100%"
        },
        "header": {
          "screen": [
            {
              "type": "typography",
              "text": "Task Detail"
            }
          ]
        },
        "screen": [
          {
            "type": "input",
            "key": "name",
            "label": "Task name",
            "layoutStyle": {
              "width": "100%"
            },
            "style": {
              "width": "100%"
            }
          },
          {
            "type": "input",
            "key": "schedule",
            "label": "Schedule Rule",
            "layoutStyle": {
              "width": "100%"
            },
            "style": {
              "width": "100%"
            }
          },
          {
            "type": "input",
            "key": "next_run_date_formatted",
            "label": "Next Run",
            "readonly": "true",
            "format": "this.data.next_run_date ? moment(this.data.next_run_date).format('L LT') : ''",
            "layoutStyle": {
              "width": "100%"
            },
            "style": {
              "width": "100%"
            }
          },
          {
            "type": "input",
            "key": "last_run_result",
            "label": "Last Run Result",
            "readonly": true,
            "layoutStyle": {
              "width": "100%"
            },
            "style": {
              "width": "100%"
            }
          },
          {
            "type": "button",
            "label": "Run Script",
            "color": "warn",
            "click": "this.data.last_run_result = 'In Queue'; this.data.logs = []; this.data.next_run_date = new Date(); this.event.send({ 'name': 'save' }); setTimeout(() => this.event.send({ 'name': 'refresh' }), 20000);",
            "layoutStyle": {
              "width": "100%"
            }
          }
        ]
      },
      {
        "expanded": false,
        "style": {
          "width": "100%"
        },
        "header": {
          "screen": [
            {
              "type": "typography",
              "text": "Script"
            }
          ]
        },
        "screen": [
          {
            "type": "input",
            "inputType": "textarea",
            "key": "script",
            "label": "Script",
            "rows": 30,
            "layoutStyle": {
              "width": "100%"
            },
            "style": {
              "width": "100%"
            }
          }
        ]
      },
      {
        "expanded": true,
        "style": {
          "width": "100%"
        },
        "header": {
          "screen": [
            {
              "type": "typography",
              "text": "Log"
            }
          ]
        },
        "screen": [
          {
            "type": "data-table",
            "tableType": "list",
            "key": "logs",
            "columns": [
              {
                "type": "typography",
                "key": "msg",
                "label": "msg"
              },
              {
                "type": "typography",
                "key": "_created",
                "format": "moment(v).format('L LTS')"
              }
            ]
          }
        ]
      }
    ]
  }
]
