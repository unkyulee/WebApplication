<ng-container *ngIf="isReady && isHandset">
  <div class="container m-4">
    <mat-card
      *ngFor="let row of data"
      class="m-4 item"
      [fxFlex]="uiElement.width ? uiElement.width : 100"
      [style.background]="uiElement.background"
    >
      <mat-card-content>
        <div *ngFor="let column of columns">
          <ng-container *ngIf="column?.link != null">
            <a
              (click)="clickLink(column?.link, row)"
              class="table-link"
              tabindex="1"
            >
              <div [ngStyle]="column?.style">
                {{
                  row[(column?.key)]
                    ? format(column, row[(column?.key)], row)
                    : "......"
                }}
              </div>
            </a>
          </ng-container>
          <ng-container *ngIf="column?.link == null">
            <ng-container *ngIf="column?.type == 'html'">
              <div
                [ngStyle]="column?.style"
                [innerHTML]="format(column, row[(column?.key)], row)"
              ></div>
            </ng-container>
            <ng-container *ngIf="column?.type != 'html'">
              <div [ngStyle]="column?.style">
                <span class="muted" *ngIf="column.cardLabelDisplay != false">{{
                  column?.label
                }}</span>
                {{ format(column, row[(column?.key)], row) }}
              </div>
            </ng-container>
          </ng-container>
          <ng-container *ngIf="column?.separator == true">
            <mat-divider></mat-divider>
          </ng-container>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <pagination
    *ngIf="total >= size"
    [total]="total"
    [page]="page"
    [size]="size"
  ></pagination>
</ng-container>

<div class="container mb-12" ngxDroppable [model]="value">
  <mat-card
    *ngFor="let item of value"
    class="m-8 item"
    ngxDraggable
    [model]="item"
    [fxFlex]="uiElement.width"
    [style.background]="uiElement.background"
  >
    <mat-card-header>
      <mat-card-title-group>
        <mat-card-title>
          <strong>
            <ng-container *ngIf="uiElement.titleLink">
              <a (click)="run(uiElement.titleLink, item)" class="link">
                {{ item[uiElement.titleKey] }}
              </a>
            </ng-container>
            <ng-container *ngIf="!uiElement.titleLink">
              {{ item[uiElement.titleKey] }}
            </ng-container>
          </strong>
        </mat-card-title>
        <mat-card-subtitle>{{
          item[uiElement.descriptionKey]
        }}</mat-card-subtitle>
      </mat-card-title-group>
      <div fxFlex></div>
      <button
        mat-icon-button
        [matMenuTriggerFor]="widgetMenu"
        aria-label="more"
        *ngIf="uiElement.workflow && uiElement.workflow.length > 0"
      >
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu
        #widgetMenu="matMenu"
        [overlapTrigger]="false"
        *ngIf="uiElement.workflow && uiElement.workflow.length > 0"
      >
        <ng-container *ngFor="let workflow of uiElement.workflow">
          <mat-divider *ngIf="workflow.divider"></mat-divider>

          <button
            mat-menu-item
            *ngIf="!workflow.divider"
            (click)="run(workflow.script, item)"
          >
            <span>{{ workflow.label }}</span>
          </button>
        </ng-container>
      </mat-menu>
    </mat-card-header>

    <mat-card-content>
      <div *ngFor="let content of uiElement.content">
        <ng-container *ngIf="content.type == 'text'">{{
          format(item[content.key], content.transform)
        }}</ng-container>
        <simple-table
          *ngIf="content.type == 'simple-table'"
          [uiElement]="content"
          [data]="item"
        ></simple-table>
        <script-button
          *ngIf="content.type == 'action-buttons'"
          [uiElement]="{ buttons: item[content.key] }"
          [data]="item"
        ></script-button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
